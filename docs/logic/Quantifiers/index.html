<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-logic/Quantifiers" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Quantifiers | Online Z3 Guide</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microsoft.github.io/z3guide/docs/logic/Quantifiers"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Quantifiers | Online Z3 Guide"><meta data-rh="true" name="description" content="Z3 is a decision procedure for the combination of the previous quantifier-free theories. That is, it can answer whether a quantifier-free formula, modulo the theories referenced by the formula, is satisfiable or whether it is unsatisfiable. Z3 also accepts and can work with formulas that use quantifiers. It is no longer a decision procedure for such formulas in general (and for good reasons, as there can be no decision procedure for first-order logic)."><meta data-rh="true" property="og:description" content="Z3 is a decision procedure for the combination of the previous quantifier-free theories. That is, it can answer whether a quantifier-free formula, modulo the theories referenced by the formula, is satisfiable or whether it is unsatisfiable. Z3 also accepts and can work with formulas that use quantifiers. It is no longer a decision procedure for such formulas in general (and for good reasons, as there can be no decision procedure for first-order logic)."><link data-rh="true" rel="icon" href="/z3guide/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://microsoft.github.io/z3guide/docs/logic/Quantifiers"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/z3guide/docs/logic/Quantifiers" hreflang="en"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/z3guide/docs/logic/Quantifiers" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WELUFTGVJI-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Online Z3 Guide" href="/z3guide/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/z3guide/coi-serviceworker.js" defer="defer"></script>
<script src="/z3guide/z3-built.js" defer="defer"></script><link rel="stylesheet" href="/z3guide/assets/css/styles.2df09eaf.css">
<script src="/z3guide/assets/js/runtime~main.503c4946.js" defer="defer"></script>
<script src="/z3guide/assets/js/main.3c84ad31.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/z3guide/"><b class="navbar__title text--truncate">Z3 Guide</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/z3guide/docs/logic/intro">SMTLIB Tutorial</a><a class="navbar__item navbar__link" href="/z3guide/programming/Z3 JavaScript Examples">Programming Z3</a><a class="navbar__item navbar__link" href="/z3guide/playground/Freeform Editing">Playground</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/z3guide" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/z3guide/docs/logic/intro">Logic</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/basiccommands">Basic Commands</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/propositional-logic">Propositional Logic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/Uninterpreted-functions-and-constants">Uninterpreted Functions and Constants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/z3guide/docs/logic/Quantifiers">Quantifiers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/Lambdas">Lambdas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/Recursive Functions">Recursive Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/z3guide/docs/logic/Conclusion">Conclusion</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/z3guide/docs/theories/Arithmetic">Theories</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/z3guide/docs/strategies/intro">Strategies</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/z3guide/docs/optimization/intro">Optimization</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/z3guide/docs/fixedpoints/intro">FixedPoints</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/z3guide/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Logic</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Quantifiers</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Quantifiers</h1></header><p>Z3 is a <a href="http://www.decision-procedures.org/" target="_blank" rel="noopener noreferrer"><em>decision procedure</em></a> for the combination of the previous quantifier-free theories. That is, it can answer whether a quantifier-free formula, modulo the theories referenced by the formula, is satisfiable or whether it is unsatisfiable. Z3 also accepts and can work with formulas that use quantifiers. It is no longer a decision procedure for such formulas in general (and for good reasons, as there can be no decision procedure for first-order logic).</p>
<p>Nevertheless, Z3 is often able to handle formulas involving quantifiers. It uses several approaches to handle quantifiers. The most prolific approach is using <em>pattern-based</em> quantifier instantiation. This approach allows instantiating quantified formulas with ground terms that appear in the current search context based on <em>pattern annotations</em> on quantifiers. The pattern-based instantiation method is quite effective, even though it is inherently incomplete.</p>
<p>Z3 also contains a model-based quantifier instantiation component that uses a model construction to find good terms to instantiate quantifiers with; and Z3 also handles many decidable fragments.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="modeling-with-quantifiers">Modeling with Quantifiers<a href="#modeling-with-quantifiers" class="hash-link" aria-label="Direct link to Modeling with Quantifiers" title="Direct link to Modeling with Quantifiers">​</a></h3>
<p>Suppose we want to model an object oriented type system with single inheritance. We would need a predicate for sub-typing. Sub-typing should be a partial order, and respect single inheritance. For some built-in type constructors, such as for array-of, sub-typing should be monotone.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>Raymond Smullyan&#x27;s puzzles are famous logical brain teasers. You can use predicate logic to encode and solve these.
On a fictional island, all inhabitants are either knights, who always tell the truth, or knaves, who always lie.
John and Bill are residents of the island of knights and knaves.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>Another related Smullyan puzzle asks
John and Bill are standing at a fork in the road. You know that one of
them is a knight and the other a knave, but you don&#x27;t know which.
You also know that one road leads to Death, and the other leads to Freedom.
By asking one yes/no question, can you determine the road to Freedom?
We leave solving this puzzle as an exercise. You can either provide a direct answer and check it,
or create a search space of abstract syntax, create an interpreter for the syntax and have z3
search for the question.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="patterns">Patterns<a href="#patterns" class="hash-link" aria-label="Direct link to Patterns" title="Direct link to Patterns">​</a></h3>
<p>The Stanford Pascal verifier and the subsequent Simplify theorem prover pioneered the use of pattern-based quantifier instantiation. The basic idea behind pattern-based quantifier instantiation is in a sense straight-forward. Annotate a quantified formula using a <em>pattern</em> that contains all the bound variables. So a pattern is an expression (that does not contain binding operations, such as quantifiers) that contains variables bound by a quantifier. Then instantiate the quantifier whenever a term that matches the pattern is created during search. This is a conceptually easy starting point, but there are several subtleties that are important.</p>
<p>In the following example, the first two options make sure that Model-based quantifier instantiation and saturation engines are disabled. We also annotate the quantified formula with the pattern (f (g x)). Since there is no ground instance of this pattern, the quantifier is not instantiated, and Z3 fails to show that the formula is unsatisfiable.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>When the more permissive pattern (g x) is used. Z3 proves the formula to be unsatisfiable. More restrictive patterns minimize the number of instantiations (and potentially improve performance), but they may also make Z3 less complete.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>Some patterns may also create long instantiation chains. Consider the following assertion.</p>
<blockquote>
<p>(assert (forall (x Type) (y Type)
(! (= (subtype x y) (subtype (array-of x) (array-of y)))
<!-- -->:pattern<!-- --> ((subtype x y))
))</p>
</blockquote>
<p>The axiom gets instantiated whenever there is some ground term of the form (subtype s t). The instantiation causes a fresh ground term (subtype (array-of s) (array-of t)), which enables a new instantiation. This undesirable situation is called a matching loop. Z3 uses many heuristics to break matching loops.</p>
<p>Before elaborating on the subtleties, we should address an important first question. What defines the terms that are created during search? In the context of most SMT solvers, and of the Simplify theorem prover, terms exist as part of the input formula, they are of course also created by instantiating quantifiers, but terms are also implicitly created when equalities are asserted. The last point means that terms are considered up to congruence and pattern matching takes place modulo ground equalities. We call the matching problem E-matching. For example, if we have the following equalities</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>The terms (f a) and (f (g b)) are equal modulo the equalities. The pattern (f (g x)) can be matched and x bound to b (and the equality (= (f (g b)) b) is deduced.</p>
<p>While E-matching is an NP-complete problem, the main sources of overhead in larger verification problems comes from matching thousands of patterns in the context of an evolving set of terms and equalities. Z3 integrates an efficient E-matching engine using term indexing techniques.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multi-patterns">Multi-patterns<a href="#multi-patterns" class="hash-link" aria-label="Direct link to Multi-patterns" title="Direct link to Multi-patterns">​</a></h3>
<p>In some cases, there is no pattern that contains all bound variables and does not contain interpreted symbols. In these cases, we use multi-patterns. In the following example, the quantified formula states that f is injective. This quantified formula is annotated with the multi-pattern (f x) (f y)</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>The quantified formula is instantiated for every pair of occurrences of f. A simple trick allows formulating injectivity of f in such a way that only a linear number of instantiations is required. The trick is to realize that f is injective if and only if it has a partial inverse.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="no-patterns">No patterns<a href="#no-patterns" class="hash-link" aria-label="Direct link to No patterns" title="Direct link to No patterns">​</a></h3>
<p>The annotation no-pattern can be used to instrument Z3 not to use a certain sub-expression as a pattern. The pattern inference engine may otherwise choose arbitrary sub-expressions as patterns to direct quantifier instantiation.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="model-based-quantifier-instantiation">Model-based Quantifier Instantiation<a href="#model-based-quantifier-instantiation" class="hash-link" aria-label="Direct link to Model-based Quantifier Instantiation" title="Direct link to Model-based Quantifier Instantiation">​</a></h3>
<p>The model-based quantifier instantiation (MBQI) is essentially a counter-example based refinement loop, where candidate models are built and checked. When the model checking step fails, it creates new quantifier instantiations. The models are returned as simple functional programs. In the following example, the model provides an interpretation for function f and constants a and b. One can easily check that the returned model does indeed satisfy the quantifier.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>The command eval evaluates an expression in the last model produced by Z3. It is essentially executing the function program produced by Z3.</p>
<p>MBQI is a decision procedure for several useful fragments. It may find models even for formulas that are not in any of these fragments. We describe some of these fragments.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="effectively-propositional">Effectively Propositional<a href="#effectively-propositional" class="hash-link" aria-label="Direct link to Effectively Propositional" title="Direct link to Effectively Propositional">​</a></h4>
<p>The effectively propositional class of formulas (aka The Bernays-Schonfinkel class) is a decidable fragment of first-order logic formulas. It corresponds to formulas which, when written in prenex normal form contain only constants, universal quantifiers, and functions that return Boolean values (aka predicates).</p>
<p>Problems arising from program verification often involve establishing facts of quantifier-free formulas, but the facts themselves use relations and functions that are conveniently axiomatized using a background theory that uses quantified formulas. One set of examples of this situation comprise of formulas involving partial-orders. The following example axiomatizes a subtype partial order relation that has the tree property. That is, if x and y are subtypes of z, then x is a subtype of y or y is a subtype of x. The option (set-option <!-- -->:model<!-- -->.compact true) instructs Z3 to eliminate trivial redundancies from the generated model. In this example, Z3 also creates a finite interpretation for the uninterpreted sort T.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>Note that it uses two auxiliary functions (subtype!25 and k!24) that were not part of your formula. They are auxiliary definitions created by Z3 during the model construction procedure. We can also ask questions by using the eval command. For example,</p>
<blockquote>
<p>(eval (subtype int-type complex-type))</p>
</blockquote>
<p>executes (evaluates) the given expression using the produced functional program (model).</p>
<p>Constraints over sets (Boolean Algebras) can be encoded into this fragment by treating sets as unary predicates and lifting equalities between sets as formula equivalence.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="stratified-sorts-fragment">Stratified Sorts Fragment<a href="#stratified-sorts-fragment" class="hash-link" aria-label="Direct link to Stratified Sorts Fragment" title="Direct link to Stratified Sorts Fragment">​</a></h4>
<p>The stratified sorts fragment is another decidable fragment of many sorted first-order logic formulas. It corresponds to formulas which, when written in prenex normal form, there is a function level from sorts to naturals, and for every function</p>
<blockquote>
<p>declare-fun f (S_1 ... S_n) R)</p>
<p>level(R)  level(S_i).</p>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="array-property-fragment">Array Property Fragment<a href="#array-property-fragment" class="hash-link" aria-label="Direct link to Array Property Fragment" title="Direct link to Array Property Fragment">​</a></h4>
<p>The array property fragment can encode properties about uni-dimensional, and is strong enough to say an array is sorted. More information about this fragment can be found in the paper <a href="https://theory.stanford.edu/~arbrad/papers/arrays.pdf" target="_blank" rel="noopener noreferrer">What&#x27;s Decidable About Arrays</a>.</p>
<p>(set-option <!-- -->:smt<!-- -->.mbqi true)
(set-option <!-- -->:model<!-- -->.compact true)</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="list-fragment">List Fragment<a href="#list-fragment" class="hash-link" aria-label="Direct link to List Fragment" title="Direct link to List Fragment">​</a></h4>
<p>The list fragment can encode properties about data-structures such as lists. For each quantified axiom q in this fragment, there is an easy way to satisfy q. More information about this fragment can be found in the paper <a href="https://people.eecs.berkeley.edu/~necula/Papers/verifier-cav05.pdf" target="_blank" rel="noopener noreferrer">Data Structure Specifications via Local Equality Axioms</a>.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="essentially-almost-uninterpreted-fragment">Essentially (Almost) Uninterpreted Fragment<a href="#essentially-almost-uninterpreted-fragment" class="hash-link" aria-label="Direct link to Essentially (Almost) Uninterpreted Fragment" title="Direct link to Essentially (Almost) Uninterpreted Fragment">​</a></h4>
<p>The essentially almost uninterpreted fragment subsumes the previous fragments, and uses a more relaxed notion of stratification. More information about this fragment can be found in the paper <a href="https://leodemoura.github.io/files/ci.pdf" target="_blank" rel="noopener noreferrer">Complete instantiation for quantified formulas in Satisfiability Modulo Theories.</a> The model based quantifier instantiation approach used in Z3 is also described in this paper. Stratified data-structures (such as arrays of pointers) can be encoded in this fragment.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>Shifts on streams (or arrays) can also be encoded.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="quantified-bit-vector-formulas">Quantified Bit-Vector Formulas<a href="#quantified-bit-vector-formulas" class="hash-link" aria-label="Direct link to Quantified Bit-Vector Formulas" title="Direct link to Quantified Bit-Vector Formulas">​</a></h4>
<p>A quantified bit-Vector formula (QBVF) is a many sorted first-order logic formula where the sort of every variable is a bit-vector sort. The QBVF satisfiability problem, is the problem of deciding whether a QBVF is satisfiable modulo the theory of bit-vectors. This problem is decidable because every universal (existential) quantifier can be expanded into a conjunction (disjunction) of potentially exponential, but finite size. A distinguishing feature in QBVF is the support for uninterpreted function and predicate symbols. More information about this fragment can be found in the paper <a href="https://www.winterstiger.at/christoph/papers/whd10.pdf" target="_blank" rel="noopener noreferrer">Efficiently Solving Quantified Bit-Vector Formulas</a>.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-and-pseudo-macros">Conditional (and Pseudo) Macros<a href="#conditional-and-pseudo-macros" class="hash-link" aria-label="Direct link to Conditional (and Pseudo) Macros" title="Direct link to Conditional (and Pseudo) Macros">​</a></h4>
<p>Quantifiers defining macros are also automatically detected by the Model Finder. In the following example, the first three quantifiers are defining f by cases.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="my-formula-is-not-in-any-of-the-fragments-above">My formula is not in any of the fragments above<a href="#my-formula-is-not-in-any-of-the-fragments-above" class="hash-link" aria-label="Direct link to My formula is not in any of the fragments above" title="Direct link to My formula is not in any of the fragments above">​</a></h4>
<p>Even if your formula is not in any of the fragments above. Z3 may still find a model for it. For example, The following simple example is not in the fragments described above.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>The Z3 preprocessor has many options that may improve the performance of the model finder. In the following example, macro-finder will expand quantifiers representing macros at preprocessing time.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<p>It is very effective in this benchmark since it contains many quantifiers of the form</p>
<blockquote>
<p>forall x.  p(x) = ....</p>
</blockquote>
<p>The Z3 model finder is more effective if the input formula does not contain nested quantifiers. If that is not the case for your formula, you can use the option</p>
<blockquote>
<p>(set-option <!-- -->:smt<!-- -->.pull-nested-quantifiers true)</p>
</blockquote>
<p>The following challenge problem from the paper <a href="https://www.ijcai.org/Proceedings/95-1/Papers/039.pdf" target="_blank" rel="noopener noreferrer">SEM a system for enumerating models</a> is proved to be unsatisfiable in less than one second by Z3.</p>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Quantifier reasoning is undecidable. Z3 attempts to find a refutation or a finite model
of quantified formulas. When formulas are satisfiable but have no finite models, z3 will
likely diverge. The following example illustrates a formula that only has infinite models.</p></div></div>
<div><div class="buttons_Vg2Y"><button class="button button--primary">Run</button></div><div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/microsoft/z3guide/tree/main/website/docs-smtlib/01 - logic/05 - Quantifiers.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/z3guide/docs/logic/Uninterpreted-functions-and-constants"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Uninterpreted Functions and Constants</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/z3guide/docs/logic/Lambdas"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lambdas</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#modeling-with-quantifiers" class="table-of-contents__link toc-highlight">Modeling with Quantifiers</a></li><li><a href="#patterns" class="table-of-contents__link toc-highlight">Patterns</a></li><li><a href="#multi-patterns" class="table-of-contents__link toc-highlight">Multi-patterns</a></li><li><a href="#no-patterns" class="table-of-contents__link toc-highlight">No patterns</a></li><li><a href="#model-based-quantifier-instantiation" class="table-of-contents__link toc-highlight">Model-based Quantifier Instantiation</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More Z3</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://z3prover.github.io/papers/programmingz3.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Programming Z3 in Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Z3Prover/z3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Z3 on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/z3guide/Acknowledgments">Acknowledgments</a></li></ul></div><div class="col footer__col"><div class="footer__title">Z3 Material</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://z3prover.github.io/api/html/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li><li class="footer__item"><a href="https://z3prover.github.io/slides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slides<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/z3prover/z3/wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Stay Connected</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/microsoft/z3guide" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/RiSE_MSR" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.microsoft.com/en-us/research/group/research-software-engineering-rise/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RiSE @ MSR<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://go.microsoft.com/fwlink/?LinkId=521839" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy &amp; Cookies<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/copyright" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademarks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><a href="https://github.com/microsoft/z3guide/commit/16e7224eb0dffe3aab8e77c3dd01ed083d0a9c0a" target="_blank" rel="noopener noreferrer">16e7224e</a> | <a href="https://www.npmjs.com/package/z3-solver/v/4.15.1" target="_blank" rel="noopener noreferrer">z3-solver 4.15.1</a> | Copyright © 2025 Microsoft Corporation.</div></div></div></footer></div>
</body>
</html>