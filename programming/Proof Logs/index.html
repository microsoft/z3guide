<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-programming docs-version-current docs-doc-page docs-doc-id-Proof Logs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Proof Logs | Online Z3 Guide</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://microsoft.github.io/z3guide/programming/Proof Logs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-programming-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-programming-current"><meta data-rh="true" property="og:title" content="Proof Logs | Online Z3 Guide"><meta data-rh="true" name="description" content="Z3 version 4.12.0 exposes new functionality to capture inferences."><meta data-rh="true" property="og:description" content="Z3 version 4.12.0 exposes new functionality to capture inferences."><link data-rh="true" rel="icon" href="/z3guide/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://microsoft.github.io/z3guide/programming/Proof Logs"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/z3guide/programming/Proof Logs" hreflang="en"><link data-rh="true" rel="alternate" href="https://microsoft.github.io/z3guide/programming/Proof Logs" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WELUFTGVJI-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Online Z3 Guide" href="/z3guide/opensearch.xml">




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous">
<script src="/z3guide/coi-serviceworker.js" defer="defer"></script>
<script src="/z3guide/z3-built.js" defer="defer"></script><link rel="stylesheet" href="/z3guide/assets/css/styles.2df09eaf.css">
<script src="/z3guide/assets/js/runtime~main.3b2e0cec.js" defer="defer"></script>
<script src="/z3guide/assets/js/main.acb00959.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/z3guide/"><b class="navbar__title text--truncate">Z3 Guide</b></a><a class="navbar__item navbar__link" href="/z3guide/docs/logic/intro">SMTLIB Tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/z3guide/programming/Z3 JavaScript Examples">Programming Z3</a><a class="navbar__item navbar__link" href="/z3guide/playground/Freeform Editing">Playground</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/microsoft/z3guide" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/z3guide/programming/Z3 JavaScript Examples">Z3 JavaScript</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/z3guide/programming/Z3 Python - Readonly/Introduction">Z3 Python - Readonly</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/z3guide/programming/Example Programs/Cores and Satisfying Subsets">Example Programs</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/z3guide/programming/Parameters">Parameters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/z3guide/programming/API Reference">API Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/z3guide/programming/Proof Logs">Proof Logs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/z3guide/programming/Local Search">Local Search</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/z3guide/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Proof Logs</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Inference logs and proofs</h1></header>
<p>Z3 version 4.12.0 exposes new functionality to capture inferences.
There is an API extension to register a callback that is invoked
whenever the main SMT engine infers a clause. It is also possible to
save inferred clauses together with proof <em>hints</em> that justify them.
We use the terminology <em>hint</em> because the justifications are <em>big step</em>
inferences. Some of the steps can be checked by lean self-contained
proof checkers, other steps do not contain detailed guidance that would allow
efficient validation. They require checking using general purpose SMT solving.</p>
<p>Proof terms have been supported from Z3 since 2008. They have been used in various settings,
including for replaying tactics in Isabelle, for generation of interpolants, and for extracting
separating hyper-planes from linear programming proofs (Farkas lemma). A separate format
is used to trace inference steps for proof mining. Proof logs allow to simplify some of the
infrastructure around proof reconstruction during search and for proof mining. The same logs
can be targeted for the different use cases. The survey <a href="https://z3prover.github.io/slides/proofs.html" target="_blank" rel="noopener noreferrer">ProofsForSMT</a> discusses proof formats in use by SMT solvers and includes some additional technical details on proof logs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="callbacks-for-clause-inferences">Callbacks for clause inferences<a href="#callbacks-for-clause-inferences" class="hash-link" aria-label="Direct link to Callbacks for clause inferences" title="Direct link to Callbacks for clause inferences">​</a></h2>
<p>The API exposes a function <code>Z3_solver_register_on_clause</code>
that is first exposed for C, C++, .Net and Python.
Here we illustrate using it from Python.
This function lets a client register a callback that is
invoked whenever the main SMT search engine makes an inference.
The main inference
steps are (1) introducing an <em>assumption</em>,
that is, a clause that is entailed by the
input formula (formally, the clause is satisfiability preserving when added to the input formula),
(2) <em>deleting</em> a clause from the set of active clauses,
(3) <em>rup</em>, inferring a clause through propositional reasoning, the clause can be justified using
<em>reverse unit propagation</em>,
(4) <em>smt</em>, or other <em>theory</em> rule, when a clause is added as a theory tautology.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="print-inferences-created-during-search">Print inferences created during search<a href="#print-inferences-created-during-search" class="hash-link" aria-label="Direct link to Print inferences created during search" title="Direct link to Print inferences created during search">​</a></h3>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="capture-just-quantifier-instantiations">Capture just quantifier instantiations<a href="#capture-just-quantifier-instantiations" class="hash-link" aria-label="Direct link to Capture just quantifier instantiations" title="Direct link to Capture just quantifier instantiations">​</a></h3>
<p>Applications that only need to monitor quantifier instantiations can filter the stream
based on the name of the proof hint.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-clauses-annotated-with-detailed-justifications">Monitor clauses annotated with detailed justifications<a href="#monitor-clauses-annotated-with-detailed-justifications" class="hash-link" aria-label="Direct link to Monitor clauses annotated with detailed justifications" title="Direct link to Monitor clauses annotated with detailed justifications">​</a></h3>
<p>If you set proof mode to <em>true</em>, then the inferred clauses
are annotated by more detailed proof terms. The detailed proof terms
use a repertoire or low level inference rules.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="monitor-proof-objects-from-the-new-core">Monitor proof objects from the new core<a href="#monitor-proof-objects-from-the-new-core" class="hash-link" aria-label="Direct link to Monitor proof objects from the new core" title="Direct link to Monitor proof objects from the new core">​</a></h3>
<p>An SMT core based on Z3&#x27;s better tuned SAT solver is accessible if you set the option
<code>sat.euf=true</code> and force it by setting <code>tactic.default_tactic=sat</code> (or to <code>smt</code>).
Proof logs have a different format from the <em>legacy</em> core. Many inferences in this format
can be checked efficiently by built-in validators.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="saving-and-restoring-inferences-to-and-from-files">Saving and restoring inferences to and from files<a href="#saving-and-restoring-inferences-to-and-from-files" class="hash-link" aria-label="Direct link to Saving and restoring inferences to and from files" title="Direct link to Saving and restoring inferences to and from files">​</a></h2>
<p>Inference logging, replay, and checking is supported for
the core enabled by setting sat.euf = true.
setting the default tactic to &#x27;sat&#x27; bypasses other tactics that could
end up using different solvers.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-the-logged-inferences-and-replay-them">Parse the logged inferences and replay them<a href="#parse-the-logged-inferences-and-replay-them" class="hash-link" aria-label="Direct link to Parse the logged inferences and replay them" title="Direct link to Parse the logged inferences and replay them">​</a></h3>
<p>You can also replay inferences when parsing a previously saved inferences.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<p>This feature can be used when proof logs are produced using a command-line process.
Log reconstruction is decoupled form the shell process.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parse-the-logged-inferences-and-check-them">Parse the logged inferences and check them<a href="#parse-the-logged-inferences-and-check-them" class="hash-link" aria-label="Direct link to Parse the logged inferences and check them" title="Direct link to Parse the logged inferences and check them">​</a></h3>
<p>Now turn on proof checking. It invokes the self-validator.
The self-validator produces log lines of the form:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   (proofs +tseitin 60 +alldiff 8 +euf 3 +rup 5 +inst 6 -quant 3 -inst 2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   (verified-smt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     (inst (forall (vars (x T) (y T) (z T)) (or (subtype (:var 2) (:var 1)) ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The &#x27;proofs&#x27; line summarizes inferences that were self-validated.
The pair +tseitin 60 indicates that 60 inferences were validated as Tseitin
encodings.
The pair <code>-inst 2</code> indicates that two quantifier instantiations were not self-validated
They were instead validated using a call to SMT solving. A log for an smt invocation
is exemplified in the next line.
Note that the pair <code>+inst 6</code> indicates that 6 quantifier instantiations were validated
using a syntactic (cheap) check. Some quantifier instantiations based on quantifier elimination
are not simple substitutions and therefore a simple syntactic check does not suffice.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-and-self-validate-on-the-fly">Verify and self-validate on the fly<a href="#verify-and-self-validate-on-the-fly" class="hash-link" aria-label="Direct link to Verify and self-validate on the fly" title="Direct link to Verify and self-validate on the fly">​</a></h3>
<p>Proof checking (self-validation) is on by default. In case someone turned it off we force it to be on in the following.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="verify-and-self-validate-on-the-fly-but-dont-check-rup">Verify and self-validate on the fly, but don&#x27;t check rup<a href="#verify-and-self-validate-on-the-fly-but-dont-check-rup" class="hash-link" aria-label="Direct link to Verify and self-validate on the fly, but don&#x27;t check rup" title="Direct link to Verify and self-validate on the fly, but don&#x27;t check rup">​</a></h3>
<p>Self-validation checks all inferences. Inferences that use theory lemmas can be checked locally without considering other inferences. Inferences that are annotated by <code>rup</code> (reverse unit propagation) are justified using global inferences (unit propagation). Checking <code>rup</code> during search can be very expensive. You can turn off <code>rup</code> checking
selectively to speed up validation for theory lemmas.</p>
<div><div class="buttons_Vg2Y"></div><div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="command-line-uses">Command line uses<a href="#command-line-uses" class="hash-link" aria-label="Direct link to Command line uses" title="Direct link to Command line uses">​</a></h2>
<p>From the command-line you can enable self-validation using the parameters</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   z3 &lt;file.smt2&gt; sat.euf=true tactic.default_tactic=smt solver.proof.check=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can disable <code>rup</code> checking</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   z3 &lt;file.smt2&gt; sat.euf=true tactic.default_tactic=smt solver.proof.check=true sat.smt.proof.check_rup=false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To save proof logs, but not check them, use</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">z3 &lt;file.smt2&gt; sat.euf=true tactic.default_tactic=smt solver.proof.log=&lt;logfile.smt2&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="inferences">Inferences<a href="#inferences" class="hash-link" aria-label="Direct link to Inferences" title="Direct link to Inferences">​</a></h2>
<p>Inferences are printed in a mild extension of SMTLIB2. The extension has three new commands</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(infer clause proof_hint)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(del clause)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume clause)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where a proof hint is a proof term that is either a detailed set of inference steps or a
generic inference that requires a proof checker that understands more than a set of simple
syntactic inferences.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="proof-hints">Proof Hints<a href="#proof-hints" class="hash-link" aria-label="Direct link to Proof Hints" title="Direct link to Proof Hints">​</a></h3>
<p>The format of proof hints is set up so it can be extended when new features are added.
Common to proof hints is that every proof hint encodes a claim in the form of a clause.
A proof hint should justify the clause.
We defer a detailed documentation of proof hints but summarize some of the main hints in use:</p>
<ul>
<li><em>tseitin</em> - The claim is justified by a Tseitin transformation.</li>
<li><em>euf</em> - The claim follows from equality reasoning.</li>
<li><em>inst</em> - A quantifier is instantiated using a binding given in the hint.</li>
<li><em>farkas</em> - The negation of the claim is a conjunction of inequalities. The farkas hint contains coefficients such that the inequalities, when added modulo multiplying with coefficients, sum up to a tight and inconsistent inequality.</li>
<li><em>bound</em> - An inequality is derived using a combination of inequalities and cuts</li>
<li><em>implied-eq</em> - An implied inequality can be derived from a set of inequalities and equalities.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-sample-session-with-proof-logs">A sample session with proof logs<a href="#a-sample-session-with-proof-logs" class="hash-link" aria-label="Direct link to A sample session with proof logs" title="Direct link to A sample session with proof logs">​</a></h2>
<p>We have the following formula</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(set-option :sat.euf true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(set-option :tactic.default_tactic smt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(set-option :solver.proof.log proof_log.smt2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun d (Int Int) Int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun t (Int Int Real) (Array Int (Array Int Real)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert (forall ((u Int) (v Real)) (= v (select (select (t v (d 1 0) (d 0 u)) 0) 0))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(check-sat)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It produces a proof log of the form</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun t (Int Int Real) (Array Int (Array Int Real)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun d (Int Int) Int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $33 Bool (forall ((u Int) (v Real))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (let ((a!1 (select (t (to_int v) (d 1 0) (to_real (d 0 u))) 0)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (= v (select a!1 0)))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume $33)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $63 Int (d 0 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $64 Real (to_real $63))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $25 Int (d 1 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $72 (Array Int (Array Int Real)) (t (- 1) $25 $64))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $73 (Array Int Real) (select $72 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $74 Real (select $73 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $75 Bool (= (- 1.0) $74))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun inst (Bool Bool Proof) Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun bind (Int Real) Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $61 Proof (bind 0 (- 1.0)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $76 Bool (not $75))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $65 Proof (inst $33 $76 $61))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer $75 $65)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $105 Int (d 0 $63))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $106 Real (to_real $105))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $113 (Array Int (Array Int Real)) (t (- 1) $25 $106))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $114 (Array Int Real) (select $113 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $115 Real (select $114 0))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $116 Bool (= (- (/ 1.0 2.0)) $115))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $109 Proof (bind $63 (- (/ 1.0 2.0))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $117 Bool (not $116))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $57 Proof (inst $33 $117 $109))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer $116 $57)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $123 Bool (= (- (/ 3.0 4.0)) $115))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $110 Proof (bind $63 (- (/ 3.0 4.0))))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $124 Bool (not $123))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $102 Proof (inst $33 $124 $110))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer $123 $102)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun euf (Bool Bool) Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $41 Proof (euf $123 $116))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer $41)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun rup () Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer rup)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The log is mildly speaking not human readable. But you can use scripts to read the log.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> z3 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set_param</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;solver.proof.check&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> Solver</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">onc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> OnClause</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_file</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;proof_log.smt2&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result is easier to digest</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">assumption [ForAll([u, v],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        v == t(ToInt(v), d(1, 0), ToReal(d(0, u)))[0][0])]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assumption [True]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inst(ForAll([u, v],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            v == t(ToInt(v), d(1, 0), ToReal(d(0, u)))[0][0]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Not(-1 == t(-1, d(1, 0), ToReal(d(0, 0)))[0][0]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     bind(0, -1)) [-1 == t(-1, d(1, 0), ToReal(d(0, 0)))[0][0]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inst(ForAll([u, v],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            v == t(ToInt(v), d(1, 0), ToReal(d(0, u)))[0][0]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Not(-(1/2) ==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         t(-1, d(1, 0), ToReal(d(0, d(0, 0))))[0][0]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     bind(d(0, 0), -(1/2))) [-(1/2) == t(-1, d(1, 0), ToReal(d(0, d(0, 0))))[0][0]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inst(ForAll([u, v],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            v == t(ToInt(v), d(1, 0), ToReal(d(0, u)))[0][0]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Not(-(3/4) ==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         t(-1, d(1, 0), ToReal(d(0, d(0, 0))))[0][0]),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     bind(d(0, 0), -(3/4))) [-(3/4) == t(-1, d(1, 0), ToReal(d(0, d(0, 0))))[0][0]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">euf(-(3/4) == t(-1, d(1, 0), ToReal(d(0, d(0, 0))))[0][0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -(1/2) == t(-1, d(1, 0), ToReal(d(0, d(0, 0))))[0][0]) []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rup []</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>SMT proofs are of course generally much larger.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="proof-trimming">Proof trimming<a href="#proof-trimming" class="hash-link" aria-label="Direct link to Proof trimming" title="Direct link to Proof trimming">​</a></h2>
<p>You can trim proofs. Consider the following example:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(set-option :sat.euf true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(set-option :tactic.default_tactic smt)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(set-option :solver.proof.log log.smt2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-const a Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-const b Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-const c Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-const d Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert (or a (not b)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert (or b (not c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert (or c (not d)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert (or d (not a)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert a)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assert (not c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(check-sat)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The contents of log.smt2:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun a () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun b () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume a (not b))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun c () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume b (not c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun d () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume c (not d))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume (not a) d)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume a)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume (not c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun rup () Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer d rup)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer rup)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let us trim the proof.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">z3 log.smt2 solver.proof.trim=true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The trimmed proof is printed to standard output.
A side-effect of trimming is a collection of dependencies that are included as arguments to a term that justifies
assumptions or inferences. Assumptions have a single number in the dependency. The number is used to identify the assumption.
Inferences list a fresh number followed by premises used by unit propagation to infer the clause.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun c () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun d () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun deps (Int) Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $32 Proof (deps 2))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume c (not d) $32)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun a () Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $34 Proof (deps 3))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume (not a) d $34)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $36 Proof (deps 4))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume a $36)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $38 Proof (deps 5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(assume (not c) $38)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun rup () Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(declare-fun deps (Int Int Int Int Int) Proof)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(define-const $40 Proof (deps 7 2 3 4 5))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(infer rup $40)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/microsoft/z3guide/tree/main/website/docs-programming/06 - Proof Logs.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/z3guide/programming/API Reference"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">API Reference</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/z3guide/programming/Local Search"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Local Search</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#callbacks-for-clause-inferences" class="table-of-contents__link toc-highlight">Callbacks for clause inferences</a><ul><li><a href="#print-inferences-created-during-search" class="table-of-contents__link toc-highlight">Print inferences created during search</a></li><li><a href="#capture-just-quantifier-instantiations" class="table-of-contents__link toc-highlight">Capture just quantifier instantiations</a></li><li><a href="#monitor-clauses-annotated-with-detailed-justifications" class="table-of-contents__link toc-highlight">Monitor clauses annotated with detailed justifications</a></li><li><a href="#monitor-proof-objects-from-the-new-core" class="table-of-contents__link toc-highlight">Monitor proof objects from the new core</a></li></ul></li><li><a href="#saving-and-restoring-inferences-to-and-from-files" class="table-of-contents__link toc-highlight">Saving and restoring inferences to and from files</a><ul><li><a href="#parse-the-logged-inferences-and-replay-them" class="table-of-contents__link toc-highlight">Parse the logged inferences and replay them</a></li><li><a href="#parse-the-logged-inferences-and-check-them" class="table-of-contents__link toc-highlight">Parse the logged inferences and check them</a></li><li><a href="#verify-and-self-validate-on-the-fly" class="table-of-contents__link toc-highlight">Verify and self-validate on the fly</a></li><li><a href="#verify-and-self-validate-on-the-fly-but-dont-check-rup" class="table-of-contents__link toc-highlight">Verify and self-validate on the fly, but don&#39;t check rup</a></li></ul></li><li><a href="#command-line-uses" class="table-of-contents__link toc-highlight">Command line uses</a></li><li><a href="#inferences" class="table-of-contents__link toc-highlight">Inferences</a><ul><li><a href="#proof-hints" class="table-of-contents__link toc-highlight">Proof Hints</a></li></ul></li><li><a href="#a-sample-session-with-proof-logs" class="table-of-contents__link toc-highlight">A sample session with proof logs</a></li><li><a href="#proof-trimming" class="table-of-contents__link toc-highlight">Proof trimming</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">More Z3</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://z3prover.github.io/papers/programmingz3.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Programming Z3 in Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/Z3Prover/z3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Z3 on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/z3guide/Acknowledgments">Acknowledgments</a></li></ul></div><div class="col footer__col"><div class="footer__title">Z3 Material</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://z3prover.github.io/api/html/index.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li><li class="footer__item"><a href="https://z3prover.github.io/slides" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slides<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/z3prover/z3/wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Stay Connected</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/microsoft/z3guide" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/RiSE_MSR" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.microsoft.com/en-us/research/group/research-software-engineering-rise/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RiSE @ MSR<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://go.microsoft.com/fwlink/?LinkId=521839" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy &amp; Cookies<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/copyright" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms of Use<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.microsoft.com/en-us/legal/intellectualproperty/trademarks/usage/general" target="_blank" rel="noopener noreferrer" class="footer__link-item">Trademarks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><a href="https://github.com/microsoft/z3guide/commit/fd5301679a7037e12c3119b0a30b5151f6d2c7ad" target="_blank" rel="noopener noreferrer">fd530167</a> | <a href="https://www.npmjs.com/package/z3-solver/v/4.15.1" target="_blank" rel="noopener noreferrer">z3-solver 4.15.1</a> | Copyright © 2025 Microsoft Corporation.</div></div></div></footer></div>
</body>
</html>